<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restoran Paneli - Restaurant App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
        }
        
        .header {
            background: #2c3e50;
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 1.5rem;
        }
        
        .nav {
            display: flex;
            gap: 1rem;
        }
        
        .nav a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            transition: background 0.3s;
        }
        
        .nav a:hover,
        .nav a.active {
            background: rgba(255,255,255,0.1);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
            margin: 0.25rem;
        }
        
        .btn-primary {
            background: #3498db;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2980b9;
        }
        
        .btn-success {
            background: #27ae60;
            color: white;
        }
        
        .btn-success:hover {
            background: #229954;
        }
        
        .btn-warning {
            background: #f39c12;
            color: white;
        }
        
        .btn-warning:hover {
            background: #e67e22;
        }
        
        .btn-danger {
            background: #e74c3c;
            color: white;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .alert {
            padding: 1rem;
            border-radius: 5px;
            margin-bottom: 1rem;
            display: none;
        }
        
        .alert-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .alert-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
            color: #666;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 0;
            border: none;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        
        .modal-header {
            background: #2c3e50;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 10px 10px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            margin: 0;
        }
        
        .close {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }
        
        .close:hover {
            opacity: 0.7;
        }
        
        .form-group {
            margin-bottom: 1rem;
            padding: 0 1.5rem;
        }
        
        .form-group:first-of-type {
            padding-top: 1.5rem;
        }
        
        .form-group:last-of-type {
            padding-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #333;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        
        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .table th,
        .table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        
        .table tr:hover {
            background-color: #f5f5f5;
        }
        
        .price {
            font-weight: bold;
            color: #27ae60;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üè™ Restoran Paneli</h1>
        <div class="nav">
            <a href="#" onclick="showPage('menu')" class="nav-link" id="menuLink">Men√º Y√∂netimi</a>
            <a href="#" onclick="showPage('orders')" class="nav-link" id="ordersLink">Sipari≈üler</a>
            <a href="#" onclick="showPage('restaurant-info')" class="nav-link" id="restaurantInfoLink">Restoran Bilgileri</a>
            <a href="#" onclick="logout()">√áƒ±kƒ±≈ü Yap</a>
        </div>
    </div>
    
    <div class="container">
        <div id="alert" class="alert"></div>
        
        <!-- Men√º Y√∂netimi Sayfasƒ± -->
        <div id="menu" class="page active">
            <div class="card">
                <h3>üçΩÔ∏è Men√º Y√∂netimi</h3>
                <button class="btn btn-primary" onclick="showAddItemForm()">Yeni √úr√ºn Ekle</button>
                <button class="btn btn-success" onclick="showCreateComboModal()">Manuel Kombinasyon Olu≈ütur</button>
                <div id="menuItems">
                    <p>Men√º √∂ƒüeleri y√ºkleniyor...</p>
                </div>
            </div>
        </div>
        
        <!-- Sipari≈üler Sayfasƒ± -->
        <div id="orders" class="page">
            <div class="card">
                <h3>üì¶ Sipari≈üler</h3>
                <div id="ordersList">
                    <p>Sipari≈üler y√ºkleniyor...</p>
                </div>
            </div>
        </div>
        
        <!-- Restoran Bilgileri Sayfasƒ± -->
        <div id="restaurant-info" class="page">
            <div class="card">
                <h3>üè™ Restoran Bilgileri</h3>
                <form id="restaurantInfoForm">
                    <div class="form-group">
                        <label for="restaurantName">Restoran Adƒ± *</label>
                        <input type="text" id="restaurantName" required>
                    </div>
                    <div class="form-group">
                        <label for="restaurantUsername">Kullanƒ±cƒ± Adƒ± *</label>
                        <input type="text" id="restaurantUsername" required>
                    </div>
                    <div class="form-group">
                        <label for="restaurantAddress">Adres</label>
                        <textarea id="restaurantAddress" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="restaurantPhone">Telefon</label>
                        <input type="tel" id="restaurantPhone">
                    </div>
                    <div class="form-group">
                        <label for="restaurantEmail">E-posta</label>
                        <input type="email" id="restaurantEmail">
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Bilgileri G√ºncelle</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div id="loading" class="loading">Y√ºkleniyor...</div>
    
    <!-- √úr√ºn Ekleme Modal -->
    <div id="itemModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Yeni √úr√ºn Ekle</h3>
                <span class="close" onclick="closeItemModal()">&times;</span>
            </div>
            <form id="itemForm">
                <div class="form-group">
                    <label for="itemName">√úr√ºn Adƒ± *</label>
                    <input type="text" id="itemName" required>
                </div>
                <div class="form-group">
                    <label for="itemDescription">A√ßƒ±klama</label>
                    <textarea id="itemDescription" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="itemPrice">Fiyat (TL) *</label>
                    <input type="number" id="itemPrice" step="0.01" min="0" required>
                </div>
                <div class="form-group">
                    <label for="itemType">T√ºr *</label>
                    <select id="itemType" required>
                        <option value="">Se√ßiniz</option>
                        <option value="food">Yemek</option>
                        <option value="drink">ƒ∞√ßecek</option>
                        <option value="dessert">Tatlƒ±</option>
                    </select>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Kaydet</button>
                    <button type="button" class="btn btn-secondary" onclick="closeItemModal()">ƒ∞ptal</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- √úr√ºn D√ºzenleme Modal -->
    <div id="editItemModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>√úr√ºn D√ºzenle</h3>
                <span class="close" onclick="closeEditItemModal()">&times;</span>
            </div>
            <form id="editItemForm">
                <input type="hidden" id="editItemId">
                <div class="form-group">
                    <label for="editItemName">√úr√ºn Adƒ± *</label>
                    <input type="text" id="editItemName" required>
                </div>
                <div class="form-group">
                    <label for="editItemDescription">A√ßƒ±klama</label>
                    <textarea id="editItemDescription" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="editItemPrice">Fiyat (TL) *</label>
                    <input type="number" id="editItemPrice" step="0.01" min="0" required>
                </div>
                <div class="form-group">
                    <label for="editItemType">T√ºr *</label>
                    <select id="editItemType" required>
                        <option value="">Se√ßiniz</option>
                        <option value="food">Yemek</option>
                        <option value="drink">ƒ∞√ßecek</option>
                        <option value="dessert">Tatlƒ±</option>
                    </select>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">G√ºncelle</button>
                    <button type="button" class="btn btn-secondary" onclick="closeEditItemModal()">ƒ∞ptal</button>
                </div>
            </form>
        </div>
    </div>
    
    
    <!-- Manuel Kombinasyon Men√º Olu≈üturma Modal -->
    <div id="createComboModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Kombinasyon Men√ºs√º Olu≈ütur</h3>
                <span class="close" onclick="closeCreateComboModal()">&times;</span>
            </div>
            <form id="createComboForm">
                <div class="form-group">
                    <label for="comboName">Kombinasyon Adƒ± *</label>
                    <input type="text" id="comboName" required placeholder="√ñrn: Pizza + ƒ∞√ßecek Kombinasyonu">
                </div>
                <div class="form-group">
                    <label for="comboDescription">A√ßƒ±klama</label>
                    <textarea id="comboDescription" rows="3" placeholder="Kombinasyon hakkƒ±nda a√ßƒ±klama..."></textarea>
                </div>
                <div class="form-group">
                    <label for="comboPrice">Fiyat (TL) *</label>
                    <input type="number" id="comboPrice" step="0.01" min="0" required placeholder="0.00">
                </div>
                <div class="form-group">
                    <label for="comboItems">Men√º √ñƒüeleri *</label>
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <select id="itemDropdown" style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="">Men√º √∂ƒüesi se√ßin...</option>
                        </select>
                        <button type="button" id="addItemBtn" onclick="addSelectedItem()" style="padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">Ekle</button>
                    </div>
                    <div id="selectedItemsContainer" style="min-height: 100px; max-height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; border-radius: 4px; background: #f9f9f9;">
                        <p style="color: #666; font-style: italic; margin: 0;">Se√ßilen √∂ƒüeler burada g√∂r√ºnecek...</p>
                    </div>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Kombinasyon Olu≈ütur</button>
                    <button type="button" class="btn btn-secondary" onclick="closeCreateComboModal()">ƒ∞ptal</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Kombinasyon Men√º D√ºzenleme Modal -->
    <div id="editComboModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Kombinasyon Men√ºs√ºn√º D√ºzenle</h3>
                <span class="close" onclick="closeEditComboModal()">&times;</span>
            </div>
            <form id="editComboForm">
                <input type="hidden" id="editComboId">
                <div class="form-group">
                    <label for="editComboName">Kombinasyon Adƒ± *</label>
                    <input type="text" id="editComboName" required placeholder="√ñrn: Pizza + ƒ∞√ßecek Kombinasyonu">
                </div>
                <div class="form-group">
                    <label for="editComboDescription">A√ßƒ±klama</label>
                    <textarea id="editComboDescription" rows="3" placeholder="Kombinasyon hakkƒ±nda a√ßƒ±klama..."></textarea>
                </div>
                <div class="form-group">
                    <label for="editComboPrice">Fiyat (TL) *</label>
                    <input type="number" id="editComboPrice" step="0.01" min="0" required placeholder="0.00">
                </div>
                <div class="form-group">
                    <label for="editComboItems">Men√º √ñƒüeleri *</label>
                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                        <select id="editItemDropdown" style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                            <option value="">Men√º √∂ƒüesi se√ßin...</option>
                        </select>
                        <button type="button" id="addEditItemBtn" onclick="addSelectedEditItem()" style="padding: 8px 16px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">Ekle</button>
                    </div>
                    <div id="editSelectedItemsContainer" style="min-height: 100px; max-height: 200px; overflow-y: auto; border: 1px solid #ddd; padding: 10px; border-radius: 4px; background: #f9f9f9;">
                        <p style="color: #666; font-style: italic; margin: 0;">Se√ßilen √∂ƒüeler burada g√∂r√ºnecek...</p>
                    </div>
                </div>
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">G√ºncelle</button>
                    <button type="button" class="btn btn-secondary" onclick="closeEditComboModal()">ƒ∞ptal</button>
                </div>
            </form>
        </div>
    </div>
    
    <script>
        const API_BASE = 'http://127.0.0.1:8000';
        let authToken = localStorage.getItem('auth_token');
        let currentUser = null;
        let currentRestaurant = null;

        // Form event listener'larƒ±
        document.addEventListener('DOMContentLoaded', function() {
            // Sayfa y√ºklendiƒüinde restoran bilgilerini y√ºkle
            loadRestaurantData();
            
            // Restoran bilgileri form submit event listener
            document.getElementById('restaurantInfoForm').addEventListener('submit', updateRestaurant);
            
            document.getElementById('itemForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const itemData = {
                    name: document.getElementById('itemName').value,
                    description: document.getElementById('itemDescription').value,
                    price: parseFloat(document.getElementById('itemPrice').value),
                    type: document.getElementById('itemType').value
                };
                addItem(itemData);
            });
            
            document.getElementById('editItemForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const itemData = {
                    name: document.getElementById('editItemName').value,
                    description: document.getElementById('editItemDescription').value,
                    price: parseFloat(document.getElementById('editItemPrice').value),
                    type: document.getElementById('editItemType').value
                };
                const itemId = document.getElementById('editItemId').value;
                updateItem(itemId, itemData);
            });
            
            
            document.getElementById('editComboForm').addEventListener('submit', updateCombo);
            
            // Modal dƒ±≈üƒ±na tƒ±klayƒ±nca kapat
            window.onclick = function(event) {
                const itemModal = document.getElementById('itemModal');
                const editItemModal = document.getElementById('editItemModal');
                const createComboModal = document.getElementById('createComboModal');
                const editComboModal = document.getElementById('editComboModal');
                if (event.target === itemModal) {
                    closeItemModal();
                }
                if (event.target === editItemModal) {
                    closeEditItemModal();
                }
                if (event.target === createComboModal) {
                    closeCreateComboModal();
                }
                if (event.target === editComboModal) {
                    closeEditComboModal();
                }
            };
        });

        window.onload = function() {
            checkUserAccess();
        };
        
        async function checkUserAccess() {
            try {
                const response = await fetch(`${API_BASE}/auth/me`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    currentUser = await response.json();
                    if (currentUser.role !== 'restaurant') {
                        window.location.href = 'login.html';
                        return;
                    }
                    await loadRestaurantData();
                } else {
                    window.location.href = 'login.html';
                }
            } catch (error) {
                console.error('Kullanƒ±cƒ± kontrol√º hatasƒ±:', error);
                window.location.href = 'login.html';
            }
        }
        
        async function loadRestaurantData() {
            try {
                // Restoran bilgilerini y√ºkle
                const response = await fetch(`${API_BASE}/restaurants/my-restaurant`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (response.ok) {
                    currentRestaurant = await response.json();
                    console.log('Y√ºklenen restoran:', currentRestaurant);
                    
                    // Restoran bilgileri formunu doldur
                    loadRestaurantInfo();
                    
                    await loadMenuItems();
                } else {
                    const error = await response.json();
                    showAlert(error.detail || 'Restoran bilgileriniz bulunamadƒ±!');
                }
            } catch (error) {
                showAlert('Restoran bilgileri y√ºklenirken hata: ' + error.message);
            }
        }
        
        function showPage(pageId) {
            // T√ºm sayfalarƒ± gizle
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // T√ºm nav linklerini pasif yap
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Se√ßilen sayfayƒ± g√∂ster
            document.getElementById(pageId).classList.add('active');
            document.getElementById(pageId + 'Link').classList.add('active');
            
            // Sayfa √∂zel y√ºkleme
            if (pageId === 'orders') {
                loadOrders();
            } else if (pageId === 'restaurant-info') {
                // Restoran bilgileri sayfasƒ±na ge√ßildiƒüinde formu doldur
                if (currentRestaurant) {
                    loadRestaurantInfo();
                }
            }
        }
        
        function showAlert(message, type = 'error') {
            const alertDiv = document.getElementById('alert');
            alertDiv.textContent = message;
            alertDiv.className = `alert alert-${type}`;
            alertDiv.style.display = 'block';
            
            setTimeout(() => {
                alertDiv.style.display = 'none';
            }, 5000);
        }
        
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }
        
        function logout() {
            localStorage.removeItem('auth_token');
            window.location.href = 'login.html';
        }
        
        function showAddItemForm() {
            document.getElementById('itemModal').style.display = 'block';
            document.getElementById('itemForm').reset();
        }
        
        function closeItemModal() {
            document.getElementById('itemModal').style.display = 'none';
        }
        
        function closeEditItemModal() {
            document.getElementById('editItemModal').style.display = 'none';
        }
        
        async function addItem(itemData) {
            try {
                showLoading(true);
                
                const response = await fetch(`${API_BASE}/menu/${currentRestaurant.id}/items`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(itemData)
                });
                
                if (response.ok) {
                    showAlert('√úr√ºn ba≈üarƒ±yla eklendi!', 'success');
                    closeItemModal();
                    loadMenuItems();
                } else {
                    const error = await response.json();
                    showAlert(error.detail || '√úr√ºn eklenemedi');
                }
            } catch (error) {
                showAlert('√úr√ºn eklenirken hata: ' + error.message);
            } finally {
                showLoading(false);
            }
        }
        
        async function updateItem(itemId, itemData) {
            try {
                showLoading(true);
                
                const response = await fetch(`${API_BASE}/menu/${currentRestaurant.id}/items/${itemId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(itemData)
                });
                
                if (response.ok) {
                    showAlert('√úr√ºn ba≈üarƒ±yla g√ºncellendi!', 'success');
                    closeEditItemModal();
                    loadMenuItems();
                } else {
                    const error = await response.json();
                    showAlert(error.detail || '√úr√ºn g√ºncellenemedi');
                }
            } catch (error) {
                showAlert('√úr√ºn g√ºncellenirken hata: ' + error.message);
            } finally {
                showLoading(false);
            }
        }
        
        function editItem(itemId, item) {
            document.getElementById('editItemId').value = itemId;
            document.getElementById('editItemName').value = item.name;
            document.getElementById('editItemDescription').value = item.description || '';
            document.getElementById('editItemPrice').value = item.price;
            document.getElementById('editItemType').value = item.type;
            document.getElementById('editItemModal').style.display = 'block';
        }
        
        async function deleteItem(itemId) {
            if (confirm('Bu √ºr√ºn√º silmek istediƒüinizden emin misiniz?')) {
                try {
                    showLoading(true);
                    
                    const response = await fetch(`${API_BASE}/menu/${currentRestaurant.id}/items/${itemId}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${authToken}`
                        }
                    });
                    
                    if (response.ok) {
                        showAlert('√úr√ºn ba≈üarƒ±yla silindi!', 'success');
                        loadMenuItems();
                    } else {
                        const error = await response.json();
                        showAlert(error.detail || '√úr√ºn silinemedi');
                    }
                } catch (error) {
                    showAlert('√úr√ºn silinirken hata: ' + error.message);
                } finally {
                    showLoading(false);
                }
            }
        }
        
        async function editComboMenu(menuId, comboData) {
            // Kombinasyon men√º d√ºzenleme fonksiyonu - API'den tam veriyi √ßek
            try {
                showLoading(true);
                
                // API'den tam combo men√º verisini √ßek
                const response = await fetch(`${API_BASE}/menu/${currentRestaurant.id}/menus/${menuId}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    const fullComboData = await response.json();
                    currentComboData = fullComboData;
                    
                    // Form alanlarƒ±nƒ± doldur
                    document.getElementById('editComboId').value = fullComboData.id;
                    document.getElementById('editComboName').value = fullComboData.name;
                    document.getElementById('editComboDescription').value = fullComboData.description || '';
                    document.getElementById('editComboPrice').value = fullComboData.price || 0;
                    
                    // Mevcut √∂ƒüeleri se√ßili olarak ayarla
                    editSelectedItems = fullComboData.items || [];
                    
                    // Men√º √∂ƒüelerini y√ºkle ve dropdown'ƒ± doldur
                    await loadItemsForEditCombo();
                    
                    // Se√ßili √∂ƒüeleri g√∂ster
                    displayEditSelectedItems();
                    
                    
                    // Modal'ƒ± g√∂ster
                    document.getElementById('editComboModal').style.display = 'block';
                } else {
                    const error = await response.json();
                    showAlert(error.detail || 'Kombinasyon men√º bilgileri y√ºklenemedi');
                }
            } catch (error) {
                showAlert('Kombinasyon men√º y√ºklenirken hata: ' + error.message);
            } finally {
                showLoading(false);
            }
        }
        
        async function deleteComboMenu(menuId) {
            if (confirm('Bu kombinasyon men√ºs√ºn√º silmek istediƒüinizden emin misiniz?')) {
                try {
                    showLoading(true);
                    
                    const response = await fetch(`${API_BASE}/menu/${currentRestaurant.id}/menus/${menuId}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${authToken}`
                        }
                    });
                    
                    if (response.ok) {
                        showAlert('Kombinasyon men√ºs√º ba≈üarƒ±yla silindi!', 'success');
                        loadMenuItems();
                    } else {
                        const error = await response.json();
                        showAlert(error.detail || 'Kombinasyon men√ºs√º silinemedi');
                    }
                } catch (error) {
                    showAlert('Kombinasyon men√ºs√º silinirken hata: ' + error.message);
                } finally {
                    showLoading(false);
                }
            }
        }
        
        async function loadMenuItems() {
            try {
                showLoading(true);
                
                if (!currentRestaurant) {
                    showAlert('√ñnce restoran bilgilerinizi y√ºkleyin');
                    return;
                }
                
                // Men√º √∂ƒüelerini y√ºkle
                const [itemsResponse, menusResponse] = await Promise.all([
                    fetch(`${API_BASE}/menu/${currentRestaurant.id}/items`, {
                        headers: { 'Authorization': `Bearer ${authToken}` }
                    }),
                    fetch(`${API_BASE}/menu/${currentRestaurant.id}/menus`, {
                        headers: { 'Authorization': `Bearer ${authToken}` }
                    })
                ]);
                
                let items = [];
                let menus = [];
                
                if (itemsResponse.ok) {
                    const itemsData = await itemsResponse.json();
                    items = Array.isArray(itemsData) ? itemsData : (itemsData.items || []);
                } else {
                    console.error('Items y√ºklenemedi:', itemsResponse.status);
                }
                
                if (menusResponse.ok) {
                    const menusData = await menusResponse.json();
                    menus = Array.isArray(menusData) ? menusData : (menusData.menus || []);
                } else {
                    console.error('Menus y√ºklenemedi:', menusResponse.status);
                }
                
                let html = '<div class="menu-management">';
                
                // T√ºm men√º √∂ƒüeleri (tekli + kombinasyon)
                const allItems = [];
                
                // Tekli men√º √∂ƒüelerini ekle
                if (items && Array.isArray(items)) {
                    items.forEach(item => {
                        allItems.push({
                            ...item,
                            isCombo: false
                        });
                    });
                }
                
                // Kombinasyon men√ºlerini ekle
                if (menus && Array.isArray(menus)) {
                    menus.forEach(menu => {
                        allItems.push({
                            id: menu.id,
                            name: menu.name,
                            description: menu.description,
                            price: menu.price,
                            type: 'combo',
                            isCombo: true,
                            items: menu.items || []
                        });
                    });
                }
                
                if (allItems.length > 0) {
                    html += `
                        <h4>üìã T√ºm Men√º √ñƒüeleri</h4>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Ad</th>
                                    <th>A√ßƒ±klama</th>
                                    <th>Fiyat</th>
                                    <th>T√ºr</th>
                                    <th>ƒ∞≈ülemler</th>
                                </tr>
                            </thead>
                            <tbody>
                    `;
                    
                    allItems.forEach(item => {
                        const typeText = {
                            'food': 'üçï Yemek',
                            'drink': 'ü•§ ƒ∞√ßecek',
                            'dessert': 'üç∞ Tatlƒ±',
                            'combo': 'üçΩÔ∏è Kombinasyon'
                        }[item.type] || item.type;
                        
                        html += `
                            <tr>
                                <td><strong>${item.name}</strong></td>
                                <td>${item.description || '-'}</td>
                                <td><span class="price">${item.price || 0} TL</span></td>
                                <td>${typeText}</td>
                                <td>
                                    ${item.isCombo 
                                        ? `<button class="btn btn-sm btn-warning" onclick="editComboMenu(${item.id}, ${JSON.stringify(item).replace(/"/g, '&quot;')})">D√ºzenle</button>
                                           <button class="btn btn-sm btn-danger" onclick="deleteComboMenu(${item.id})">Sil</button>`
                                        : `<button class="btn btn-sm btn-warning" onclick="editItem(${item.id}, ${JSON.stringify(item).replace(/"/g, '&quot;')})">D√ºzenle</button>
                                           <button class="btn btn-sm btn-danger" onclick="deleteItem(${item.id})">Sil</button>`
                                    }
                                </td>
                            </tr>
                        `;
                    });
                    
                    html += '</tbody></table>';
                } else {
                    html += '<p>Hen√ºz men√º √∂ƒüesi eklenmemi≈ü. Yeni √ºr√ºn ekleyin!</p>';
                }
                
                
                html += '</div>';
                document.getElementById('menuItems').innerHTML = html;
                
            } catch (error) {
                showAlert('Men√º √∂ƒüeleri y√ºklenirken hata: ' + error.message);
            } finally {
                showLoading(false);
            }
        }
        
        // Manuel kombinasyon men√º olu≈üturma fonksiyonlarƒ±
        function showCreateComboModal() {
            loadItemsForCombo();
            document.getElementById('createComboModal').style.display = 'block';
            
            // Dropdown click handler'ƒ±nƒ± kur
            setTimeout(() => {
                setupDropdownClickHandler();
            }, 100);
        }
        
        function closeCreateComboModal() {
            document.getElementById('createComboModal').style.display = 'none';
            document.getElementById('createComboForm').reset();
            
            // Se√ßilen √∂ƒüeleri temizle
            selectedItems = [];
            
            // Dropdown'ƒ± yeniden y√ºkle
            populateItemDropdown();
            
            // Se√ßilen √∂ƒüeleri temizle
            displaySelectedItems();
        }
        
        let availableItems = [];
        let selectedItems = [];
        let editAvailableItems = [];
        let editSelectedItems = [];
        let currentComboData = null;
        
        async function loadItemsForCombo() {
            try {
                const response = await fetch(`${API_BASE}/menu/${currentRestaurant.id}/items`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    
                    // API direkt array d√∂nd√ºr√ºyor, items wrapper'ƒ± yok
                    availableItems = Array.isArray(data) ? data : (data.items || []);
                    
                    // G√ºvenli kontrol
                    if (!availableItems || !Array.isArray(availableItems)) {
                        availableItems = [];
                    }
                    
                    populateItemDropdown();
                } else {
                    availableItems = [];
                    document.getElementById('itemDropdown').innerHTML = '<option value="">Men√º √∂ƒüeleri y√ºklenemedi</option>';
                }
            } catch (error) {
                availableItems = [];
                document.getElementById('itemDropdown').innerHTML = '<option value="">Hata: ' + error.message + '</option>';
            }
        }
        
        function populateItemDropdown() {
            const dropdown = document.getElementById('itemDropdown');
            if (!dropdown) {
                return;
            }
            
            dropdown.innerHTML = '<option value="">Men√º √∂ƒüesi se√ßin...</option>';
            
            // G√ºvenli kontrol
            if (!availableItems || !Array.isArray(availableItems) || availableItems.length === 0) {
                dropdown.innerHTML = '<option value="">Hen√ºz men√º √∂ƒüesi yok</option>';
                return;
            }
            
            availableItems.forEach(item => {
                if (item && item.id && item.name) {
                    const option = document.createElement('option');
                    option.value = item.id;
                    option.textContent = `${item.name} (${item.type || 'N/A'} - ${item.price || 0}‚Ç∫)`;
                    option.dataset.item = JSON.stringify(item);
                    dropdown.appendChild(option);
                }
            });
        }
        
        // Dropdown'a tƒ±klandƒ±ƒüƒ±nda men√º √∂ƒüelerini y√ºkle
        function setupDropdownClickHandler() {
            const dropdown = document.getElementById('itemDropdown');
            if (dropdown) {
                dropdown.addEventListener('click', function() {
                    // Eƒüer hen√ºz y√ºklenmemi≈üse y√ºkle
                    if (availableItems.length === 0) {
                        loadItemsForCombo();
                    }
                });
            }
        }
        
        function addSelectedItem() {
            const dropdown = document.getElementById('itemDropdown');
            if (!dropdown) {
                console.error('Dropdown not found');
                return;
            }
            
            const selectedValue = dropdown.value;
            
            if (!selectedValue) {
                alert('L√ºtfen bir men√º √∂ƒüesi se√ßin');
                return;
            }
            
            const selectedOption = dropdown.options[dropdown.selectedIndex];
            if (!selectedOption || !selectedOption.dataset.item) {
                console.error('Selected option or item data not found');
                return;
            }
            
            try {
                const item = JSON.parse(selectedOption.dataset.item);
                
                // Zaten se√ßilmi≈ü mi kontrol et
                if (selectedItems.find(selected => selected.id === item.id)) {
                    alert('Bu √∂ƒüe zaten se√ßilmi≈ü');
                    return;
                }
                
                // Se√ßilen √∂ƒüeyi listeye ekle
                selectedItems.push(item);
                
                // Dropdown'dan kaldƒ±r
                selectedOption.remove();
                
                // Se√ßilen √∂ƒüeleri g√∂ster
                displaySelectedItems();
            } catch (error) {
                console.error('Error parsing item data:', error);
                alert('Men√º √∂ƒüesi verisi okunamadƒ±');
            }
        }
        
        function removeSelectedItem(itemId) {
            const item = selectedItems.find(selected => selected.id === itemId);
            if (item) {
                // Se√ßilen √∂ƒüelerden kaldƒ±r
                selectedItems = selectedItems.filter(selected => selected.id !== itemId);
                
                // Dropdown'a geri ekle
                const dropdown = document.getElementById('itemDropdown');
                const option = document.createElement('option');
                option.value = item.id;
                option.textContent = `${item.name} (${item.type} - ${item.price}‚Ç∫)`;
                option.dataset.item = JSON.stringify(item);
                dropdown.appendChild(option);
                
                // Se√ßilen √∂ƒüeleri g√ºncelle
                displaySelectedItems();
            }
        }
        
        function displaySelectedItems() {
            const container = document.getElementById('selectedItemsContainer');
            if (!container) {
                console.error('Selected items container not found');
                return;
            }
            
            // G√ºvenli kontrol
            if (!selectedItems || !Array.isArray(selectedItems) || selectedItems.length === 0) {
                container.innerHTML = '<p style="color: #666; font-style: italic; margin: 0;">Se√ßilen √∂ƒüeler burada g√∂r√ºnecek...</p>';
                return;
            }
            
            let html = '<div style="display: flex; flex-direction: column; gap: 8px;">';
            
            selectedItems.forEach(item => {
                if (item && item.id && item.name) {
                    html += `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; background: white; border: 1px solid #ddd; border-radius: 4px;">
                            <div>
                                <div style="font-weight: bold;">${item.name || 'ƒ∞simsiz'}</div>
                                <div style="font-size: 0.9em; color: #666;">${item.type || 'N/A'} - ${item.price || 0}‚Ç∫</div>
                            </div>
                            <button type="button" onclick="removeSelectedItem(${item.id})" style="background: #dc3545; color: white; border: none; border-radius: 4px; padding: 4px 8px; cursor: pointer; font-size: 0.8em;">Kaldƒ±r</button>
                        </div>
                    `;
                }
            });
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        // Kombinasyon men√º d√ºzenleme fonksiyonlarƒ±
        
        async function loadItemsForEditCombo() {
            try {
                const response = await fetch(`${API_BASE}/menu/${currentRestaurant.id}/items`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    editAvailableItems = Array.isArray(data) ? data : (data.items || []);
                    populateEditItemDropdown();
                } else {
                    editAvailableItems = [];
                    document.getElementById('editItemDropdown').innerHTML = '<option value="">Men√º √∂ƒüeleri y√ºklenemedi</option>';
                }
            } catch (error) {
                editAvailableItems = [];
                document.getElementById('editItemDropdown').innerHTML = '<option value="">Hata: ' + error.message + '</option>';
            }
        }
        
        function populateEditItemDropdown() {
            const dropdown = document.getElementById('editItemDropdown');
            if (!dropdown) {
                return;
            }
            
            dropdown.innerHTML = '<option value="">Men√º √∂ƒüesi se√ßin...</option>';
            
            if (!editAvailableItems || !Array.isArray(editAvailableItems) || editAvailableItems.length === 0) {
                dropdown.innerHTML = '<option value="">Hen√ºz men√º √∂ƒüesi yok</option>';
                return;
            }
            
            // Sadece hen√ºz se√ßilmemi≈ü √∂ƒüeleri g√∂ster
            const unselectedItems = editAvailableItems.filter(item => 
                !editSelectedItems.find(selected => selected.id === item.id)
            );
            
            unselectedItems.forEach(item => {
                if (item && item.id && item.name) {
                    const option = document.createElement('option');
                    option.value = item.id;
                    option.textContent = `${item.name} (${item.type || 'N/A'} - ${item.price || 0}‚Ç∫)`;
                    option.dataset.item = JSON.stringify(item);
                    dropdown.appendChild(option);
                }
            });
        }
        
        function addSelectedEditItem() {
            const dropdown = document.getElementById('editItemDropdown');
            if (!dropdown) {
                console.error('Edit dropdown not found');
                return;
            }
            
            const selectedValue = dropdown.value;
            
            if (!selectedValue) {
                alert('L√ºtfen bir men√º √∂ƒüesi se√ßin');
                return;
            }
            
            const selectedOption = dropdown.options[dropdown.selectedIndex];
            if (!selectedOption || !selectedOption.dataset.item) {
                console.error('Selected option or item data not found');
                return;
            }
            
            try {
                const item = JSON.parse(selectedOption.dataset.item);
                
                // Zaten se√ßilmi≈ü mi kontrol et
                if (editSelectedItems.find(selected => selected.id === item.id)) {
                    alert('Bu √∂ƒüe zaten se√ßilmi≈ü');
                    return;
                }
                
                // Se√ßilen √∂ƒüeyi listeye ekle
                editSelectedItems.push(item);
                
                // Dropdown'dan kaldƒ±r
                selectedOption.remove();
                
                // Se√ßilen √∂ƒüeleri g√∂ster
                displayEditSelectedItems();
                
                // Fiyatƒ± g√ºncelle
            } catch (error) {
                console.error('Error parsing item data:', error);
                alert('Men√º √∂ƒüesi verisi okunamadƒ±');
            }
        }
        
        function removeSelectedEditItem(itemId) {
            const item = editSelectedItems.find(selected => selected.id === itemId);
            if (item) {
                // Se√ßilen √∂ƒüelerden kaldƒ±r
                editSelectedItems = editSelectedItems.filter(selected => selected.id !== itemId);
                
                // Dropdown'a geri ekle
                const dropdown = document.getElementById('editItemDropdown');
                const option = document.createElement('option');
                option.value = item.id;
                option.textContent = `${item.name} (${item.type} - ${item.price}‚Ç∫)`;
                option.dataset.item = JSON.stringify(item);
                dropdown.appendChild(option);
                
                // Se√ßilen √∂ƒüeleri g√ºncelle
                displayEditSelectedItems();
                
                // Fiyatƒ± g√ºncelle
            }
        }
        
        function displayEditSelectedItems() {
            const container = document.getElementById('editSelectedItemsContainer');
            if (!container) {
                console.error('Edit selected items container not found');
                return;
            }
            
            if (!editSelectedItems || !Array.isArray(editSelectedItems) || editSelectedItems.length === 0) {
                container.innerHTML = '<p style="color: #666; font-style: italic; margin: 0;">Se√ßilen √∂ƒüeler burada g√∂r√ºnecek...</p>';
                return;
            }
            
            let html = '<div style="display: flex; flex-direction: column; gap: 8px;">';
            
            editSelectedItems.forEach(item => {
                if (item && item.id && item.name) {
                    html += `
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px; background: white; border: 1px solid #ddd; border-radius: 4px;">
                            <div>
                                <div style="font-weight: bold;">${item.name || 'ƒ∞simsiz'}</div>
                                <div style="font-size: 0.9em; color: #666;">${item.type || 'N/A'} - ${item.price || 0}‚Ç∫</div>
                            </div>
                            <button type="button" onclick="removeSelectedEditItem(${item.id})" style="background: #dc3545; color: white; border: none; border-radius: 4px; padding: 4px 8px; cursor: pointer; font-size: 0.8em;">Kaldƒ±r</button>
                        </div>
                    `;
                }
            });
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        
        function closeEditComboModal() {
            document.getElementById('editComboModal').style.display = 'none';
            document.getElementById('editComboForm').reset();
            
            // Se√ßilen √∂ƒüeleri temizle
            editSelectedItems = [];
            currentComboData = null;
            
            // Dropdown'ƒ± yeniden y√ºkle
            populateEditItemDropdown();
            
            // Se√ßilen √∂ƒüeleri temizle
            displayEditSelectedItems();
        }
        
        async function updateCombo(event) {
            event.preventDefault();
            
            // G√ºvenli kontrol
            if (!editSelectedItems || !Array.isArray(editSelectedItems) || editSelectedItems.length === 0) {
                showAlert('L√ºtfen en az bir men√º √∂ƒüesi se√ßin!', 'error');
                return;
            }
            
            const selectedItemIds = editSelectedItems.map(item => item.id).filter(id => id);
            
            const comboData = {
                name: document.getElementById('editComboName').value,
                description: document.getElementById('editComboDescription').value,
                price: parseFloat(document.getElementById('editComboPrice').value) || 0,
                item_ids: selectedItemIds
            };
            
            try {
                showLoading(true);
                
                // menus tablosunu g√ºncelle
                const response = await fetch(`${API_BASE}/menu/${currentRestaurant.id}/menus/${currentComboData.id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(comboData)
                });
                
                if (response.ok) {
                    showAlert('Kombinasyon men√ºs√º ba≈üarƒ±yla g√ºncellendi!', 'success');
                    closeEditComboModal();
                    loadMenuItems();
                } else {
                    const error = await response.json();
                    showAlert(error.detail || 'Kombinasyon men√ºs√º g√ºncellenemedi');
                }
            } catch (error) {
                showAlert('Kombinasyon men√ºs√º g√ºncellenirken hata: ' + error.message);
            } finally {
                showLoading(false);
            }
        }
        
        // Form submit event listener
        document.getElementById('createComboForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // G√ºvenli kontrol
            if (!selectedItems || !Array.isArray(selectedItems) || selectedItems.length === 0) {
                showAlert('L√ºtfen en az bir men√º √∂ƒüesi se√ßin!', 'error');
                return;
            }
            
            const selectedItemIds = selectedItems.map(item => item.id).filter(id => id);
            
            const comboData = {
                name: document.getElementById('comboName').value,
                description: document.getElementById('comboDescription').value,
                price: parseFloat(document.getElementById('comboPrice').value),
                item_ids: selectedItemIds
            };
            
            try {
                showLoading(true);
                
                const response = await fetch(`${API_BASE}/menu/${currentRestaurant.id}/create-manual-combo`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(comboData)
                });
                
                if (response.ok) {
                    showAlert('Kombinasyon men√ºs√º ba≈üarƒ±yla olu≈üturuldu!', 'success');
                    closeCreateComboModal();
                    loadMenuItems();
                } else {
                    const error = await response.json();
                    showAlert(error.detail || 'Kombinasyon men√ºs√º olu≈üturulamadƒ±');
                }
            } catch (error) {
                showAlert('Kombinasyon men√ºs√º olu≈üturulurken hata: ' + error.message);
            } finally {
                showLoading(false);
            }
        });
        
        async function loadOrders() {
            try {
                showLoading(true);
                
                const response = await fetch(`${API_BASE}/orders/restaurant/${currentRestaurant.id}`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                
                if (response.ok) {
                    const orders = await response.json();
                    
                    let html = '<div class="orders-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1rem;">';
                    
                    if (orders.length > 0) {
                        orders.forEach(order => {
                            const statusClass = getStatusClass(order.status);
                            const statusText = getStatusText(order.status);
                            
                            html += `
                                <div class="order-card" style="background: white; border-radius: 8px; padding: 1rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border-left: 4px solid ${getStatusColor(order.status)};">
                                    <div class="order-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                        <h4 style="margin: 0; color: #2c3e50;">Sipari≈ü #${order.id}</h4>
                                        <span class="status-badge ${statusClass}" style="padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.8rem; font-weight: bold;">${statusText}</span>
                                    </div>
                                    
                                    <div class="order-details" style="margin-bottom: 1rem;">
                                        <p style="margin: 0.5rem 0;"><strong>üë§ M√º≈üteri:</strong> ${order.customer_name}</p>
                                        <p style="margin: 0.5rem 0;"><strong>üìû Telefon:</strong> ${order.customer_phone}</p>
                                        <p style="margin: 0.5rem 0;"><strong>üìç Adres:</strong> ${order.delivery_address}</p>
                                        <p style="margin: 0.5rem 0;"><strong>üí∞ Tutar:</strong> ${order.total_price}‚Ç∫</p>
                                        <p style="margin: 0.5rem 0;"><strong>üìÖ Tarih:</strong> ${new Date(order.created_at).toLocaleString('tr-TR')}</p>
                                    </div>
                                    
                                    <div class="order-actions" style="margin-top: 1rem;">
                                        <select id="statusSelect_${order.id}" onchange="updateOrderStatus(${order.id})" style="width: 100%; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; margin-bottom: 0.5rem;">
                                            <option value="created" ${order.status === 'created' ? 'selected' : ''}>Yeni Sipari≈ü</option>
                                            <option value="paid" ${order.status === 'paid' ? 'selected' : ''}>√ñdendi</option>
                                            <option value="preparing" ${order.status === 'preparing' ? 'selected' : ''}>Hazƒ±rlanƒ±yor</option>
                                            <option value="delivering" ${order.status === 'delivering' ? 'selected' : ''}>Yolda</option>
                                            <option value="delivered" ${order.status === 'delivered' ? 'selected' : ''}>Teslim Edildi</option>
                                            <option value="cancelled" ${order.status === 'cancelled' ? 'selected' : ''}>ƒ∞ptal Edildi</option>
                                        </select>
                                    </div>
                                </div>
                            `;
                        });
                    } else {
                        html += '<div style="grid-column: 1 / -1; text-align: center; padding: 2rem; color: #666;">Hen√ºz sipari≈ü bulunmuyor.</div>';
                    }
                    
                    html += '</div>';
                    document.getElementById('ordersList').innerHTML = html;
                } else {
                    showAlert('Sipari≈üler y√ºklenirken hata olu≈ütu');
                }
            } catch (error) {
                showAlert('Sipari≈üler y√ºklenirken hata: ' + error.message);
            } finally {
                showLoading(false);
            }
        }
        
        function getStatusClass(status) {
            const statusMap = {
                'created': 'status-new',
                'paid': 'status-paid',
                'preparing': 'status-preparing',
                'delivering': 'status-delivering',
                'delivered': 'status-delivered',
                'cancelled': 'status-cancelled'
            };
            return statusMap[status] || 'status-new';
        }
        
        function getStatusText(status) {
            const statusMap = {
                'created': 'Yeni Sipari≈ü',
                'paid': '√ñdendi',
                'preparing': 'Hazƒ±rlanƒ±yor',
                'delivering': 'Yolda',
                'delivered': 'Teslim Edildi',
                'cancelled': 'ƒ∞ptal Edildi'
            };
            return statusMap[status] || 'Bilinmeyen';
        }
        
        function getStatusColor(status) {
            const colorMap = {
                'created': '#3498db',
                'paid': '#f39c12',
                'preparing': '#e67e22',
                'delivering': '#9b59b6',
                'delivered': '#27ae60',
                'cancelled': '#e74c3c'
            };
            return colorMap[status] || '#3498db';
        }
        
        // Restoran bilgileri fonksiyonlarƒ±
        function loadRestaurantInfo() {
            if (!currentRestaurant) {
                showAlert('Restoran bilgileri y√ºklenemedi');
                return;
            }
            
            // Form alanlarƒ±nƒ± doldur
            document.getElementById('restaurantName').value = currentRestaurant.name || '';
            document.getElementById('restaurantUsername').value = currentRestaurant.username || '';
            document.getElementById('restaurantAddress').value = currentRestaurant.address || '';
            document.getElementById('restaurantPhone').value = currentRestaurant.phone || '';
            document.getElementById('restaurantEmail').value = currentRestaurant.email || '';
        }
        
        
        async function updateRestaurant(event) {
            event.preventDefault();
            
            if (!currentRestaurant) {
                showAlert('Restoran bilgileri y√ºklenemedi');
                return;
            }
            
            const formData = {
                name: document.getElementById('restaurantName').value,
                username: document.getElementById('restaurantUsername').value,
                address: document.getElementById('restaurantAddress').value,
                phone: document.getElementById('restaurantPhone').value,
                email: document.getElementById('restaurantEmail').value
            };
            
            try {
                showLoading(true);
                
                const response = await fetch(`${API_BASE}/restaurants/my-restaurant`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(formData)
                });
                
                if (response.ok) {
                    const updatedRestaurant = await response.json();
                    currentRestaurant = updatedRestaurant;
                    showAlert('Restoran bilgileri ba≈üarƒ±yla g√ºncellendi!', 'success');
                    loadRestaurantInfo(); // Bilgileri yenile
                } else {
                    const error = await response.json();
                    showAlert('Restoran g√ºncellenirken hata: ' + (error.detail || 'Bilinmeyen hata'));
                }
            } catch (error) {
                showAlert('Restoran g√ºncellenirken hata: ' + error.message);
            } finally {
                showLoading(false);
            }
        }
        
        async function updateOrderStatus(orderId) {
            try {
                const selectElement = document.getElementById(`statusSelect_${orderId}`);
                const newStatus = selectElement.value;
                
                const response = await fetch(`${API_BASE}/orders/${orderId}/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ new_status: newStatus })
                });
                
                if (response.ok) {
                    showAlert('Sipari≈ü durumu g√ºncellendi!', 'success');
                    loadOrders(); // Sayfayƒ± yenile
                } else {
                    showAlert('Sipari≈ü durumu g√ºncellenirken hata olu≈ütu');
                    loadOrders(); // Hata durumunda da sayfayƒ± yenile
                }
            } catch (error) {
                showAlert('Sipari≈ü durumu g√ºncellenirken hata: ' + error.message);
                loadOrders();
            }
        }
    </script>
</body>
</html>
